---
import { Icon } from 'astro-icon/components';

const links = [
   { name: 'Resumen', href: '#resumen', icon: 'user' },
   { name: 'Experiencia', href: '#experiencia', icon: 'maletin' },
   { name: 'Tecnologías', href: '#tecnologias', icon: 'user-shield' },
   { name: 'Proyectos', href: '#proyectos', icon: 'code' },
   { name: 'Sobre Mí', href: '#sobremi', icon: 'users' },
];
---

<nav
   id="navbar"
   class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
>
   <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex h-14 items-center justify-end md:justify-center">
         <div class="hidden md:block">
            <div class="flex items-center space-x-8">
               {
                  links.map(({ href, icon, name }) => (
                     <a
                        href={href}
                        class="flex items-center gap-x-2  transition-all duration-200 text-secondary hover:text-primary  cursor-pointer  hover:underline"
                     >
                        <Icon name={icon} size={16} />
                        <span class="text-sm font-medium">{name}</span>
                     </a>
                  ))
               }
            </div>
         </div>

         <div class="md:hidden">
            <button
               id="menu-btn"
               class="rounded-lg p-2 transition-colors duration-200 text-primary"
               aria-label="Abrir menú de navegación"
               aria-expanded="false"
               aria-controls="mobile-menu"
            >
               <Icon id="icon-menu" name="menu" size={24} />
               <Icon id="icon-close" name="x" size={24} class="hidden" />
            </button>
         </div>
      </div>
   </div>

   <div id="mobile-menu" class="hidden md:hidden border-b-2 border-border">
      <div class="px-4 py-6 backdrop-blur-md bg-background-card">
         <div class="space-y-1">
            {
               links.map((item) => (
                  <a
                     href={item.href}
                     class="mobile-links flex w-full items-center gap-3 rounded-lg px-4 py-3 text-left transition-colors duration-200 text-secondary hover:text-primary hover:bg-background cursor-pointer"
                  >
                     <Icon name={item.icon} size={20} />
                     <span class="font-medium">{item.name}</span>
                  </a>
               ))
            }
         </div>
      </div>
   </div>
</nav>

<script>
   const btn = document.getElementById('menu-btn');
   const menu = document.getElementById('mobile-menu');
   const navbar = document.getElementById('navbar');
   const iconMenu = document.getElementById('icon-menu');
   const iconClose = document.getElementById('icon-close');
   const allMobileLinks = document.querySelectorAll('.mobile-links');

   function updateNavbarBlur() {
      const isMenuOpen = !menu?.classList.contains('hidden');
      const isScrolled = window.scrollY > 50;
      if (isMenuOpen) {
         navbar?.classList.remove('backdrop-blur-sm', 'bg-black/20');
         navbar?.classList.add('bg-background-card');
      } else if (isScrolled) {
         navbar?.classList.remove('bg-background-card');
         navbar?.classList.add('backdrop-blur-sm', 'bg-black/20');
      } else {
         navbar?.classList.remove(
            'backdrop-blur-sm',
            'bg-black/20',
            'bg-background-card'
         );
      }
   }

   btn?.addEventListener('click', () => {
      const isOpen = !menu?.classList.contains('hidden');
      menu?.classList.toggle('hidden');
      iconMenu?.classList.toggle('hidden');
      iconClose?.classList.toggle('hidden');

      btn.setAttribute('aria-expanded', String(!isOpen));
      btn.setAttribute(
         'aria-label',
         isOpen ? 'Abrir menú de navegación' : 'Cerrar menú de navegación'
      );
      updateNavbarBlur();
   });

   window.addEventListener('scroll', updateNavbarBlur);

   allMobileLinks.forEach((link) => {
      link.addEventListener('click', () => {
         menu?.classList.toggle('hidden');
         iconMenu?.classList.toggle('hidden');
         iconClose?.classList.toggle('hidden');
      });
   });
</script>
